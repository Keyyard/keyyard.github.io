import{r as x,j as B}from"./react-CCMnDkE2.js";import{L as ce,T as Ze,R as et,U as tt,a as nt,O as rt,P as ot,S as Se,b as ue,N as it,A as st,B as at,M as lt,C as ct,W as ut,c as ft,d as dt,e as pt,V as vt,f as ee,g as ht,h as mt,i as gt}from"./three-DouXCBQv.js";import{c as Me}from"./debounce-Cd2PdaYF.js";import{F as yt,u as wt}from"./its-fine-DiUZp3mG.js";import{R as bt,c as K}from"./react-reconciler-Dtzc7liT.js";import"./react-dom-Cv6Ihgnh.js";import"./maath-CHXMaFB-.js";import{G as Ce,D as _t,M as fe}from"./three-stdlib-DD6Odp8E.js";import{c as Ct}from"./zustand-tkqYnUfI.js";import{s as Et,p as Pt,c as St}from"./suspend-react-BKIKQNXN.js";var dn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function pn(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ze={exports:{}},Ie={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(g,E){var b=g.length;g.push(E);e:for(;0<b;){var P=b-1>>>1,A=g[P];if(0<c(A,E))g[P]=E,g[b]=A,b=P;else break e}}function o(g){return g.length===0?null:g[0]}function i(g){if(g.length===0)return null;var E=g[0],b=g.pop();if(b!==E){g[0]=b;e:for(var P=0,A=g.length,D=A>>>1;P<D;){var F=2*(P+1)-1,q=g[F],U=F+1,re=g[U];if(0>c(q,b))U<A&&0>c(re,q)?(g[P]=re,g[U]=b,P=U):(g[P]=q,g[F]=b,P=F);else if(U<A&&0>c(re,b))g[P]=re,g[U]=b,P=U;else break e}}return E}function c(g,E){var b=g.sortIndex-E.sortIndex;return b!==0?b:g.id-E.id}if(typeof performance=="object"&&typeof performance.now=="function"){var p=performance;e.unstable_now=function(){return p.now()}}else{var C=Date,u=C.now();e.unstable_now=function(){return C.now()-u}}var l=[],m=[],n=1,r=null,a=3,d=!1,h=!1,y=!1,v=typeof setTimeout=="function"?setTimeout:null,s=typeof clearTimeout=="function"?clearTimeout:null,f=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(g){for(var E=o(m);E!==null;){if(E.callback===null)i(m);else if(E.startTime<=g)i(m),E.sortIndex=E.expirationTime,t(l,E);else break;E=o(m)}}function S(g){if(y=!1,w(g),!h)if(o(l)!==null)h=!0,H(O);else{var E=o(m);E!==null&&G(S,E.startTime-g)}}function O(g,E){h=!1,y&&(y=!1,s(k),k=-1),d=!0;var b=a;try{for(w(E),r=o(l);r!==null&&(!(r.expirationTime>E)||g&&!_());){var P=r.callback;if(typeof P=="function"){r.callback=null,a=r.priorityLevel;var A=P(r.expirationTime<=E);E=e.unstable_now(),typeof A=="function"?r.callback=A:r===o(l)&&i(l),w(E)}else i(l);r=o(l)}if(r!==null)var D=!0;else{var F=o(m);F!==null&&G(S,F.startTime-E),D=!1}return D}finally{r=null,a=b,d=!1}}var M=!1,j=null,k=-1,L=5,R=-1;function _(){return!(e.unstable_now()-R<L)}function T(){if(j!==null){var g=e.unstable_now();R=g;var E=!0;try{E=j(!0,g)}finally{E?I():(M=!1,j=null)}}else M=!1}var I;if(typeof f=="function")I=function(){f(T)};else if(typeof MessageChannel<"u"){var N=new MessageChannel,W=N.port2;N.port1.onmessage=T,I=function(){W.postMessage(null)}}else I=function(){v(T,0)};function H(g){j=g,M||(M=!0,I())}function G(g,E){k=v(function(){g(e.unstable_now())},E)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(g){g.callback=null},e.unstable_continueExecution=function(){h||d||(h=!0,H(O))},e.unstable_forceFrameRate=function(g){0>g||125<g?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):L=0<g?Math.floor(1e3/g):5},e.unstable_getCurrentPriorityLevel=function(){return a},e.unstable_getFirstCallbackNode=function(){return o(l)},e.unstable_next=function(g){switch(a){case 1:case 2:case 3:var E=3;break;default:E=a}var b=a;a=E;try{return g()}finally{a=b}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(g,E){switch(g){case 1:case 2:case 3:case 4:case 5:break;default:g=3}var b=a;a=g;try{return E()}finally{a=b}},e.unstable_scheduleCallback=function(g,E,b){var P=e.unstable_now();switch(typeof b=="object"&&b!==null?(b=b.delay,b=typeof b=="number"&&0<b?P+b:P):b=P,g){case 1:var A=-1;break;case 2:A=250;break;case 5:A=1073741823;break;case 4:A=1e4;break;default:A=5e3}return A=b+A,g={id:n++,callback:E,priorityLevel:g,startTime:b,expirationTime:A,sortIndex:-1},b>P?(g.sortIndex=b,t(m,g),o(l)===null&&g===o(m)&&(y?(s(k),k=-1):y=!0,G(S,b-P))):(g.sortIndex=A,t(l,g),h||d||(h=!0,H(O))),g},e.unstable_shouldYield=_,e.unstable_wrapCallback=function(g){var E=a;return function(){var b=a;a=E;try{return g.apply(this,arguments)}finally{a=b}}}})(Ie);ze.exports=Ie;var Oe=ze.exports;const Ee={},Mt=e=>void Object.assign(Ee,e);function Ot(e,t){function o(n,{args:r=[],attach:a,...d},h){let y=`${n[0].toUpperCase()}${n.slice(1)}`,v;if(n==="primitive"){if(d.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const s=d.object;v=$(s,{type:n,root:h,attach:a,primitive:!0})}else{const s=Ee[y];if(!s)throw new Error(`R3F: ${y} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(r))throw new Error("R3F: The args prop must be an array!");v=$(new s(...r),{type:n,root:h,attach:a,memoizedProps:{args:r}})}return v.__r3f.attach===void 0&&(v instanceof at?v.__r3f.attach="geometry":v instanceof lt&&(v.__r3f.attach="material")),y!=="inject"&&ve(v,d),v}function i(n,r){let a=!1;if(r){var d,h;(d=r.__r3f)!=null&&d.attach?pe(n,r,r.__r3f.attach):r.isObject3D&&n.isObject3D&&(n.add(r),a=!0),a||(h=n.__r3f)==null||h.objects.push(r),r.__r3f||$(r,{}),r.__r3f.parent=n,_e(r),Y(r)}}function c(n,r,a){let d=!1;if(r){var h,y;if((h=r.__r3f)!=null&&h.attach)pe(n,r,r.__r3f.attach);else if(r.isObject3D&&n.isObject3D){r.parent=n,r.dispatchEvent({type:"added"}),n.dispatchEvent({type:"childadded",child:r});const v=n.children.filter(f=>f!==r),s=v.indexOf(a);n.children=[...v.slice(0,s),r,...v.slice(s)],d=!0}d||(y=n.__r3f)==null||y.objects.push(r),r.__r3f||$(r,{}),r.__r3f.parent=n,_e(r),Y(r)}}function p(n,r,a=!1){n&&[...n].forEach(d=>C(r,d,a))}function C(n,r,a){if(r){var d,h,y;if(r.__r3f&&(r.__r3f.parent=null),(d=n.__r3f)!=null&&d.objects&&(n.__r3f.objects=n.__r3f.objects.filter(S=>S!==r)),(h=r.__r3f)!=null&&h.attach)xe(n,r,r.__r3f.attach);else if(r.isObject3D&&n.isObject3D){var v;n.remove(r),(v=r.__r3f)!=null&&v.root&&zt(ae(r),r)}const f=(y=r.__r3f)==null?void 0:y.primitive,w=!f&&(a===void 0?r.dispose!==null:a);if(!f){var s;p((s=r.__r3f)==null?void 0:s.objects,r,w),p(r.children,r,w)}if(delete r.__r3f,w&&r.dispose&&r.type!=="Scene"){const S=()=>{try{r.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?Oe.unstable_scheduleCallback(Oe.unstable_IdlePriority,S):S()}Y(n)}}function u(n,r,a,d){var h;const y=(h=n.__r3f)==null?void 0:h.parent;if(!y)return;const v=o(r,a,n.__r3f.root);if(n.children){for(const s of n.children)s.__r3f&&i(v,s);n.children=n.children.filter(s=>!s.__r3f)}n.__r3f.objects.forEach(s=>i(v,s)),n.__r3f.objects=[],n.__r3f.autoRemovedBeforeAppend||C(y,n),v.parent&&(v.__r3f.autoRemovedBeforeAppend=!0),i(y,v),v.raycast&&v.__r3f.eventCount&&ae(v).getState().internal.interaction.push(v),[d,d.alternate].forEach(s=>{s!==null&&(s.stateNode=v,s.ref&&(typeof s.ref=="function"?s.ref(v):s.ref.current=v))})}const l=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:bt({createInstance:o,removeChild:C,appendChild:i,appendInitialChild:i,insertBefore:c,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(n,r)=>{if(!r)return;const a=n.getState().scene;a.__r3f&&(a.__r3f.root=n,i(a,r))},removeChildFromContainer:(n,r)=>{r&&C(n.getState().scene,r)},insertInContainerBefore:(n,r,a)=>{if(!r||!a)return;const d=n.getState().scene;d.__r3f&&c(d,r,a)},getRootHostContext:()=>null,getChildHostContext:n=>n,finalizeInitialChildren(n){var r;return!!((r=n==null?void 0:n.__r3f)!=null?r:{}).handlers},prepareUpdate(n,r,a,d){var h;if(((h=n==null?void 0:n.__r3f)!=null?h:{}).primitive&&d.object&&d.object!==n)return[!0];{const{args:v=[],children:s,...f}=d,{args:w=[],children:S,...O}=a;if(!Array.isArray(v))throw new Error("R3F: the args prop must be an array!");if(v.some((j,k)=>j!==w[k]))return[!0];const M=Ue(n,f,O,!0);return M.changes.length?[!1,M]:null}},commitUpdate(n,[r,a],d,h,y,v){r?u(n,d,y,v):ve(n,a)},commitMount(n,r,a,d){var h;const y=(h=n.__r3f)!=null?h:{};n.raycast&&y.handlers&&y.eventCount&&ae(n).getState().internal.interaction.push(n)},getPublicInstance:n=>n,prepareForCommit:()=>null,preparePortalMount:n=>$(n.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(n){var r;const{attach:a,parent:d}=(r=n.__r3f)!=null?r:{};a&&d&&xe(d,n,a),n.isObject3D&&(n.visible=!1),Y(n)},unhideInstance(n,r){var a;const{attach:d,parent:h}=(a=n.__r3f)!=null?a:{};d&&h&&pe(h,n,d),(n.isObject3D&&r.visible==null||r.visible)&&(n.visible=!0),Y(n)},createTextInstance:l,hideTextInstance:l,unhideTextInstance:l,getCurrentEventPriority:()=>t?t():K.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&z.fun(performance.now)?performance.now:z.fun(Date.now)?Date.now:()=>0,scheduleTimeout:z.fun(setTimeout)?setTimeout:void 0,cancelTimeout:z.fun(clearTimeout)?clearTimeout:void 0}),applyProps:ve}}var Re,je;const de=e=>"colorSpace"in e||"outputColorSpace"in e,Fe=()=>{var e;return(e=Ee.ColorManagement)!=null?e:null},Be=e=>e&&e.isOrthographicCamera,Rt=e=>e&&e.hasOwnProperty("current"),te=typeof window<"u"&&((Re=window.document)!=null&&Re.createElement||((je=window.navigator)==null?void 0:je.product)==="ReactNative")?x.useLayoutEffect:x.useEffect;function He(e){const t=x.useRef(e);return te(()=>void(t.current=e),[e]),t}function jt({set:e}){return te(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class Ne extends x.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}Ne.getDerivedStateFromError=()=>({error:!0});const Ge="__default",ke=new Map,kt=e=>e&&!!e.memoized&&!!e.changes;function qe(e){var t;const o=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],o),e[1]):e}const Q=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()};function ae(e){let t=e.__r3f.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const z={obj:e=>e===Object(e)&&!z.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:o="shallow",objects:i="reference",strict:c=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(z.str(e)||z.num(e)||z.boo(e))return e===t;const p=z.obj(e);if(p&&i==="reference")return e===t;const C=z.arr(e);if(C&&o==="reference")return e===t;if((C||p)&&e===t)return!0;let u;for(u in e)if(!(u in t))return!1;if(p&&o==="shallow"&&i==="shallow"){for(u in c?t:e)if(!z.equ(e[u],t[u],{strict:c,objects:"reference"}))return!1}else for(u in c?t:e)if(e[u]!==t[u])return!1;if(z.und(u)){if(C&&e.length===0&&t.length===0||p&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function Tt(e){const t={nodes:{},materials:{}};return e&&e.traverse(o=>{o.name&&(t.nodes[o.name]=o),o.material&&!t.materials[o.material.name]&&(t.materials[o.material.name]=o.material)}),t}function xt(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function $(e,t){const o=e;return o.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function be(e,t){let o=e;if(t.includes("-")){const i=t.split("-"),c=i.pop();return o=i.reduce((p,C)=>p[C],e),{target:o,key:c}}else return{target:o,key:t}}const Te=/-\d+$/;function pe(e,t,o){if(z.str(o)){if(Te.test(o)){const p=o.replace(Te,""),{target:C,key:u}=be(e,p);Array.isArray(C[u])||(C[u]=[])}const{target:i,key:c}=be(e,o);t.__r3f.previousAttach=i[c],i[c]=t}else t.__r3f.previousAttach=o(e,t)}function xe(e,t,o){var i,c;if(z.str(o)){const{target:p,key:C}=be(e,o),u=t.__r3f.previousAttach;u===void 0?delete p[C]:p[C]=u}else(i=t.__r3f)==null||i.previousAttach==null||i.previousAttach(e,t);(c=t.__r3f)==null||delete c.previousAttach}function Ue(e,{children:t,key:o,ref:i,...c},{children:p,key:C,ref:u,...l}={},m=!1){const n=e.__r3f,r=Object.entries(c),a=[];if(m){const h=Object.keys(l);for(let y=0;y<h.length;y++)c.hasOwnProperty(h[y])||r.unshift([h[y],Ge+"remove"])}r.forEach(([h,y])=>{var v;if((v=e.__r3f)!=null&&v.primitive&&h==="object"||z.equ(y,l[h]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(h))return a.push([h,y,!0,[]]);let s=[];h.includes("-")&&(s=h.split("-")),a.push([h,y,!1,s]);for(const f in c){const w=c[f];f.startsWith(`${h}-`)&&a.push([f,w,!1,f.split("-")])}});const d={...c};return n!=null&&n.memoizedProps&&n!=null&&n.memoizedProps.args&&(d.args=n.memoizedProps.args),n!=null&&n.memoizedProps&&n!=null&&n.memoizedProps.attach&&(d.attach=n.memoizedProps.attach),{memoized:d,changes:a}}const Lt=typeof process<"u"&&!1;function ve(e,t){var o;const i=e.__r3f,c=i==null?void 0:i.root,p=c==null||c.getState==null?void 0:c.getState(),{memoized:C,changes:u}=kt(t)?t:Ue(e,t),l=i==null?void 0:i.eventCount;e.__r3f&&(e.__r3f.memoizedProps=C);for(let n=0;n<u.length;n++){let[r,a,d,h]=u[n];if(de(e)){const f="srgb",w="srgb-linear";r==="encoding"?(r="colorSpace",a=a===3001?f:w):r==="outputEncoding"&&(r="outputColorSpace",a=a===3001?f:w)}let y=e,v=y[r];if(h.length&&(v=h.reduce((s,f)=>s[f],e),!(v&&v.set))){const[s,...f]=h.reverse();y=f.reverse().reduce((w,S)=>w[S],e),r=s}if(a===Ge+"remove")if(y.constructor){let s=ke.get(y.constructor);s||(s=new y.constructor,ke.set(y.constructor,s)),a=s[r]}else a=0;if(d&&i)a?i.handlers[r]=a:delete i.handlers[r],i.eventCount=Object.keys(i.handlers).length;else if(v&&v.set&&(v.copy||v instanceof ce)){if(Array.isArray(a))v.fromArray?v.fromArray(a):v.set(...a);else if(v.copy&&a&&a.constructor&&(Lt?v.constructor.name===a.constructor.name:v.constructor===a.constructor))v.copy(a);else if(a!==void 0){const s=v instanceof ct;!s&&v.setScalar?v.setScalar(a):v instanceof ce&&a instanceof ce?v.mask=a.mask:v.set(a),!Fe()&&p&&!p.linear&&s&&v.convertSRGBToLinear()}}else if(y[r]=a,y[r]instanceof Ze&&y[r].format===et&&y[r].type===tt&&p){const s=y[r];de(s)&&de(p.gl)?s.colorSpace=p.gl.outputColorSpace:s.encoding=p.gl.outputEncoding}Y(e)}if(i&&i.parent&&e.raycast&&l!==i.eventCount){const n=ae(e).getState().internal,r=n.interaction.indexOf(e);r>-1&&n.interaction.splice(r,1),i.eventCount&&n.interaction.push(e)}return!(u.length===1&&u[0][0]==="onUpdate")&&u.length&&(o=e.__r3f)!=null&&o.parent&&_e(e),e}function Y(e){var t,o;const i=(t=e.__r3f)==null||(o=t.root)==null||o.getState==null?void 0:o.getState();i&&i.internal.frames===0&&i.invalidate()}function _e(e){e.onUpdate==null||e.onUpdate(e)}function At(e,t){e.manual||(Be(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function oe(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function Dt(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return K.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return K.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return K.ContinuousEventPriority;default:return K.DefaultEventPriority}}function We(e,t,o,i){const c=o.get(t);c&&(o.delete(t),o.size===0&&(e.delete(i),c.target.releasePointerCapture(i)))}function zt(e,t){const{internal:o}=e.getState();o.interaction=o.interaction.filter(i=>i!==t),o.initialHits=o.initialHits.filter(i=>i!==t),o.hovered.forEach((i,c)=>{(i.eventObject===t||i.object===t)&&o.hovered.delete(c)}),o.capturedMap.forEach((i,c)=>{We(o.capturedMap,t,i,c)})}function It(e){function t(l){const{internal:m}=e.getState(),n=l.offsetX-m.initialClick[0],r=l.offsetY-m.initialClick[1];return Math.round(Math.sqrt(n*n+r*r))}function o(l){return l.filter(m=>["Move","Over","Enter","Out","Leave"].some(n=>{var r;return(r=m.__r3f)==null?void 0:r.handlers["onPointer"+n]}))}function i(l,m){const n=e.getState(),r=new Set,a=[],d=m?m(n.internal.interaction):n.internal.interaction;for(let s=0;s<d.length;s++){const f=Q(d[s]);f&&(f.raycaster.camera=void 0)}n.previousRoot||n.events.compute==null||n.events.compute(l,n);function h(s){const f=Q(s);if(!f||!f.events.enabled||f.raycaster.camera===null)return[];if(f.raycaster.camera===void 0){var w;f.events.compute==null||f.events.compute(l,f,(w=f.previousRoot)==null?void 0:w.getState()),f.raycaster.camera===void 0&&(f.raycaster.camera=null)}return f.raycaster.camera?f.raycaster.intersectObject(s,!0):[]}let y=d.flatMap(h).sort((s,f)=>{const w=Q(s.object),S=Q(f.object);return!w||!S?s.distance-f.distance:S.events.priority-w.events.priority||s.distance-f.distance}).filter(s=>{const f=oe(s);return r.has(f)?!1:(r.add(f),!0)});n.events.filter&&(y=n.events.filter(y,n));for(const s of y){let f=s.object;for(;f;){var v;(v=f.__r3f)!=null&&v.eventCount&&a.push({...s,eventObject:f}),f=f.parent}}if("pointerId"in l&&n.internal.capturedMap.has(l.pointerId))for(let s of n.internal.capturedMap.get(l.pointerId).values())r.has(oe(s.intersection))||a.push(s.intersection);return a}function c(l,m,n,r){const a=e.getState();if(l.length){const d={stopped:!1};for(const h of l){const y=Q(h.object)||a,{raycaster:v,pointer:s,camera:f,internal:w}=y,S=new ee(s.x,s.y,0).unproject(f),O=R=>{var _,T;return(_=(T=w.capturedMap.get(R))==null?void 0:T.has(h.eventObject))!=null?_:!1},M=R=>{const _={intersection:h,target:m.target};w.capturedMap.has(R)?w.capturedMap.get(R).set(h.eventObject,_):w.capturedMap.set(R,new Map([[h.eventObject,_]])),m.target.setPointerCapture(R)},j=R=>{const _=w.capturedMap.get(R);_&&We(w.capturedMap,h.eventObject,_,R)};let k={};for(let R in m){let _=m[R];typeof _!="function"&&(k[R]=_)}let L={...h,...k,pointer:s,intersections:l,stopped:d.stopped,delta:n,unprojectedPoint:S,ray:v.ray,camera:f,stopPropagation(){const R="pointerId"in m&&w.capturedMap.get(m.pointerId);if((!R||R.has(h.eventObject))&&(L.stopped=d.stopped=!0,w.hovered.size&&Array.from(w.hovered.values()).find(_=>_.eventObject===h.eventObject))){const _=l.slice(0,l.indexOf(h));p([..._,h])}},target:{hasPointerCapture:O,setPointerCapture:M,releasePointerCapture:j},currentTarget:{hasPointerCapture:O,setPointerCapture:M,releasePointerCapture:j},nativeEvent:m};if(r(L),d.stopped===!0)break}}return l}function p(l){const{internal:m}=e.getState();for(const n of m.hovered.values())if(!l.length||!l.find(r=>r.object===n.object&&r.index===n.index&&r.instanceId===n.instanceId)){const a=n.eventObject.__r3f,d=a==null?void 0:a.handlers;if(m.hovered.delete(oe(n)),a!=null&&a.eventCount){const h={...n,intersections:l};d.onPointerOut==null||d.onPointerOut(h),d.onPointerLeave==null||d.onPointerLeave(h)}}}function C(l,m){for(let n=0;n<m.length;n++){const r=m[n].__r3f;r==null||r.handlers.onPointerMissed==null||r.handlers.onPointerMissed(l)}}function u(l){switch(l){case"onPointerLeave":case"onPointerCancel":return()=>p([]);case"onLostPointerCapture":return m=>{const{internal:n}=e.getState();"pointerId"in m&&n.capturedMap.has(m.pointerId)&&requestAnimationFrame(()=>{n.capturedMap.has(m.pointerId)&&(n.capturedMap.delete(m.pointerId),p([]))})}}return function(n){const{onPointerMissed:r,internal:a}=e.getState();a.lastEvent.current=n;const d=l==="onPointerMove",h=l==="onClick"||l==="onContextMenu"||l==="onDoubleClick",v=i(n,d?o:void 0),s=h?t(n):0;l==="onPointerDown"&&(a.initialClick=[n.offsetX,n.offsetY],a.initialHits=v.map(w=>w.eventObject)),h&&!v.length&&s<=2&&(C(n,a.interaction),r&&r(n)),d&&p(v);function f(w){const S=w.eventObject,O=S.__r3f,M=O==null?void 0:O.handlers;if(O!=null&&O.eventCount)if(d){if(M.onPointerOver||M.onPointerEnter||M.onPointerOut||M.onPointerLeave){const j=oe(w),k=a.hovered.get(j);k?k.stopped&&w.stopPropagation():(a.hovered.set(j,w),M.onPointerOver==null||M.onPointerOver(w),M.onPointerEnter==null||M.onPointerEnter(w))}M.onPointerMove==null||M.onPointerMove(w)}else{const j=M[l];j?(!h||a.initialHits.includes(S))&&(C(n,a.interaction.filter(k=>!a.initialHits.includes(k))),j(w)):h&&a.initialHits.includes(S)&&C(n,a.interaction.filter(k=>!a.initialHits.includes(k)))}}c(v,n,s,f)}}return{handlePointer:u}}const Ve=e=>!!(e!=null&&e.render),Xe=x.createContext(null),Ft=(e,t)=>{const o=Ct((u,l)=>{const m=new ee,n=new ee,r=new ee;function a(s=l().camera,f=n,w=l().size){const{width:S,height:O,top:M,left:j}=w,k=S/O;f instanceof ee?r.copy(f):r.set(...f);const L=s.getWorldPosition(m).distanceTo(r);if(Be(s))return{width:S/s.zoom,height:O/s.zoom,top:M,left:j,factor:1,distance:L,aspect:k};{const R=s.fov*Math.PI/180,_=2*Math.tan(R/2)*L,T=_*(S/O);return{width:T,height:_,top:M,left:j,factor:S/T,distance:L,aspect:k}}}let d;const h=s=>u(f=>({performance:{...f.performance,current:s}})),y=new ht;return{set:u,get:l,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(s=1)=>e(l(),s),advance:(s,f)=>t(s,f,l()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new mt,pointer:y,mouse:y,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const s=l();d&&clearTimeout(d),s.performance.current!==s.performance.min&&h(s.performance.min),d=setTimeout(()=>h(l().performance.max),s.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:a},setEvents:s=>u(f=>({...f,events:{...f.events,...s}})),setSize:(s,f,w,S,O)=>{const M=l().camera,j={width:s,height:f,top:S||0,left:O||0,updateStyle:w};u(k=>({size:j,viewport:{...k.viewport,...a(M,n,j)}}))},setDpr:s=>u(f=>{const w=qe(s);return{viewport:{...f.viewport,dpr:w,initialDpr:f.viewport.initialDpr||w}}}),setFrameloop:(s="always")=>{const f=l().clock;f.stop(),f.elapsedTime=0,s!=="never"&&(f.start(),f.elapsedTime=0),u(()=>({frameloop:s}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:x.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(s,f,w)=>{const S=l().internal;return S.priority=S.priority+(f>0?1:0),S.subscribers.push({ref:s,priority:f,store:w}),S.subscribers=S.subscribers.sort((O,M)=>O.priority-M.priority),()=>{const O=l().internal;O!=null&&O.subscribers&&(O.priority=O.priority-(f>0?1:0),O.subscribers=O.subscribers.filter(M=>M.ref!==s))}}}}}),i=o.getState();let c=i.size,p=i.viewport.dpr,C=i.camera;return o.subscribe(()=>{const{camera:u,size:l,viewport:m,gl:n,set:r}=o.getState();if(l.width!==c.width||l.height!==c.height||m.dpr!==p){var a;c=l,p=m.dpr,At(u,l),n.setPixelRatio(m.dpr);const d=(a=l.updateStyle)!=null?a:typeof HTMLCanvasElement<"u"&&n.domElement instanceof HTMLCanvasElement;n.setSize(l.width,l.height,d)}u!==C&&(C=u,r(d=>({viewport:{...d.viewport,...d.viewport.getCurrentViewport(u)}})))}),o.subscribe(u=>e(u)),o};let ie,Bt=new Set,Ht=new Set,Nt=new Set;function he(e,t){if(e.size)for(const{callback:o}of e.values())o(t)}function Z(e,t){switch(e){case"before":return he(Bt,t);case"after":return he(Ht,t);case"tail":return he(Nt,t)}}let me,ge;function ye(e,t,o){let i=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),me=t.internal.subscribers,ie=0;ie<me.length;ie++)ge=me[ie],ge.ref.current(ge.store.getState(),i,o);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function Gt(e){let t=!1,o=!1,i,c,p;function C(m){c=requestAnimationFrame(C),t=!0,i=0,Z("before",m),o=!0;for(const r of e.values()){var n;p=r.store.getState(),p.internal.active&&(p.frameloop==="always"||p.internal.frames>0)&&!((n=p.gl.xr)!=null&&n.isPresenting)&&(i+=ye(m,p))}if(o=!1,Z("after",m),i===0)return Z("tail",m),t=!1,cancelAnimationFrame(c)}function u(m,n=1){var r;if(!m)return e.forEach(a=>u(a.store.getState(),n));(r=m.gl.xr)!=null&&r.isPresenting||!m.internal.active||m.frameloop==="never"||(n>1?m.internal.frames=Math.min(60,m.internal.frames+n):o?m.internal.frames=2:m.internal.frames=1,t||(t=!0,requestAnimationFrame(C)))}function l(m,n=!0,r,a){if(n&&Z("before",m),r)ye(m,r,a);else for(const d of e.values())ye(m,d.store.getState());n&&Z("after",m)}return{loop:C,invalidate:u,advance:l}}function qt(){const e=x.useContext(Xe);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function vn(e,t=0){const o=qt(),i=o.getState().internal.subscribe,c=He(e);return te(()=>i(c,t,o),[t,i,o]),null}const Le=new WeakMap;function $e(e,t){return function(o,...i){let c=Le.get(o);return c||(c=new o,Le.set(o,c)),e&&e(c),Promise.all(i.map(p=>new Promise((C,u)=>c.load(p,l=>{l.scene&&Object.assign(l,Tt(l.scene)),C(l)},t,l=>u(new Error(`Could not load ${p}: ${l==null?void 0:l.message}`))))))}}function ne(e,t,o,i){const c=Array.isArray(t)?t:[t],p=Et($e(o,i),[e,...c],{equal:z.equ});return Array.isArray(t)?p:p[0]}ne.preload=function(e,t,o){const i=Array.isArray(t)?t:[t];return Pt($e(o),[e,...i])};ne.clear=function(e,t){const o=Array.isArray(t)?t:[t];return St([e,...o])};const J=new Map,{invalidate:Ae,advance:De}=Gt(J),{reconciler:le,applyProps:V}=Ot(J,Dt),X={objects:"shallow",strict:!1},Ut=(e,t)=>{const o=typeof e=="function"?e(t):e;return Ve(o)?o:new ut({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function Wt(e,t){const o=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(t){const{width:i,height:c,top:p,left:C,updateStyle:u=o}=t;return{width:i,height:c,top:p,left:C,updateStyle:u}}else if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:i,height:c,top:p,left:C}=e.parentElement.getBoundingClientRect();return{width:i,height:c,top:p,left:C,updateStyle:o}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0,updateStyle:o};return{width:0,height:0,top:0,left:0}}function Vt(e){const t=J.get(e),o=t==null?void 0:t.fiber,i=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const c=typeof reportError=="function"?reportError:console.error,p=i||Ft(Ae,De),C=o||le.createContainer(p,K.ConcurrentRoot,null,!1,null,"",c,null);t||J.set(e,{fiber:C,store:p});let u,l=!1,m;return{configure(n={}){let{gl:r,size:a,scene:d,events:h,onCreated:y,shadows:v=!1,linear:s=!1,flat:f=!1,legacy:w=!1,orthographic:S=!1,frameloop:O="always",dpr:M=[1,2],performance:j,raycaster:k,camera:L,onPointerMissed:R}=n,_=p.getState(),T=_.gl;_.gl||_.set({gl:T=Ut(r,e)});let I=_.raycaster;I||_.set({raycaster:I=new nt});const{params:N,...W}=k||{};if(z.equ(W,I,X)||V(I,{...W}),z.equ(N,I.params,X)||V(I,{params:{...I.params,...N}}),!_.camera||_.camera===m&&!z.equ(m,L,X)){m=L;const b=L instanceof ft,P=b?L:S?new rt(0,0,0,0,.1,1e3):new ot(75,0,.1,1e3);b||(P.position.z=5,L&&(V(P,L),("aspect"in L||"left"in L||"right"in L||"bottom"in L||"top"in L)&&(P.manual=!0,P.updateProjectionMatrix())),!_.camera&&!(L!=null&&L.rotation)&&P.lookAt(0,0,0)),_.set({camera:P}),I.camera=P}if(!_.scene){let b;d instanceof Se?b=d:(b=new Se,d&&V(b,d)),_.set({scene:$(b)})}if(!_.xr){var H;const b=(D,F)=>{const q=p.getState();q.frameloop!=="never"&&De(D,!0,q,F)},P=()=>{const D=p.getState();D.gl.xr.enabled=D.gl.xr.isPresenting,D.gl.xr.setAnimationLoop(D.gl.xr.isPresenting?b:null),D.gl.xr.isPresenting||Ae(D)},A={connect(){const D=p.getState().gl;D.xr.addEventListener("sessionstart",P),D.xr.addEventListener("sessionend",P)},disconnect(){const D=p.getState().gl;D.xr.removeEventListener("sessionstart",P),D.xr.removeEventListener("sessionend",P)}};typeof((H=T.xr)==null?void 0:H.addEventListener)=="function"&&A.connect(),_.set({xr:A})}if(T.shadowMap){const b=T.shadowMap.enabled,P=T.shadowMap.type;if(T.shadowMap.enabled=!!v,z.boo(v))T.shadowMap.type=ue;else if(z.str(v)){var G;const A={basic:dt,percentage:pt,soft:ue,variance:vt};T.shadowMap.type=(G=A[v])!=null?G:ue}else z.obj(v)&&Object.assign(T.shadowMap,v);(b!==T.shadowMap.enabled||P!==T.shadowMap.type)&&(T.shadowMap.needsUpdate=!0)}const g=Fe();g&&("enabled"in g?g.enabled=!w:"legacyMode"in g&&(g.legacyMode=w)),l||V(T,{outputEncoding:s?3e3:3001,toneMapping:f?it:st}),_.legacy!==w&&_.set(()=>({legacy:w})),_.linear!==s&&_.set(()=>({linear:s})),_.flat!==f&&_.set(()=>({flat:f})),r&&!z.fun(r)&&!Ve(r)&&!z.equ(r,T,X)&&V(T,r),h&&!_.events.handlers&&_.set({events:h(p)});const E=Wt(e,a);return z.equ(E,_.size,X)||_.setSize(E.width,E.height,E.updateStyle,E.top,E.left),M&&_.viewport.dpr!==qe(M)&&_.setDpr(M),_.frameloop!==O&&_.setFrameloop(O),_.onPointerMissed||_.set({onPointerMissed:R}),j&&!z.equ(j,_.performance,X)&&_.set(b=>({performance:{...b.performance,...j}})),u=y,l=!0,this},render(n){return l||this.configure(),le.updateContainer(B.jsx(Xt,{store:p,children:n,onCreated:u,rootElement:e}),C,null,()=>{}),p},unmount(){Ye(e)}}}function Xt({store:e,children:t,onCreated:o,rootElement:i}){return te(()=>{const c=e.getState();c.set(p=>({internal:{...p.internal,active:!0}})),o&&o(c),e.getState().events.connected||c.events.connect==null||c.events.connect(i)},[]),B.jsx(Xe.Provider,{value:e,children:t})}function Ye(e,t){const o=J.get(e),i=o==null?void 0:o.fiber;if(i){const c=o==null?void 0:o.store.getState();c&&(c.internal.active=!1),le.updateContainer(null,i,null,()=>{c&&setTimeout(()=>{try{var p,C,u,l;c.events.disconnect==null||c.events.disconnect(),(p=c.gl)==null||(C=p.renderLists)==null||C.dispose==null||C.dispose(),(u=c.gl)==null||u.forceContextLoss==null||u.forceContextLoss(),(l=c.gl)!=null&&l.xr&&c.xr.disconnect(),xt(c),J.delete(e)}catch{}},500)})}}le.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:x.version});const we={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function $t(e){const{handlePointer:t}=It(e);return{priority:1,enabled:!0,compute(o,i,c){i.pointer.set(o.offsetX/i.size.width*2-1,-(o.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(we).reduce((o,i)=>({...o,[i]:t(i)}),{}),update:()=>{var o;const{events:i,internal:c}=e.getState();(o=c.lastEvent)!=null&&o.current&&i.handlers&&i.handlers.onPointerMove(c.lastEvent.current)},connect:o=>{var i;const{set:c,events:p}=e.getState();p.disconnect==null||p.disconnect(),c(C=>({events:{...C.events,connected:o}})),Object.entries((i=p.handlers)!=null?i:[]).forEach(([C,u])=>{const[l,m]=we[C];o.addEventListener(l,u,{passive:m})})},disconnect:()=>{const{set:o,events:i}=e.getState();if(i.connected){var c;Object.entries((c=i.handlers)!=null?c:[]).forEach(([p,C])=>{if(i&&i.connected instanceof HTMLElement){const[u]=we[p];i.connected.removeEventListener(u,C)}}),o(p=>({events:{...p.events,connected:void 0}}))}}}}function Yt({debounce:e,scroll:t,polyfill:o,offsetSize:i}={debounce:0,scroll:!1,offsetSize:!1}){const c=o||typeof window<"u"&&window.ResizeObserver,[p,C]=x.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0});if(!c)return p.width=1280,p.height=800,[()=>{},p,()=>{}];const u=x.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:p}),l=e?typeof e=="number"?e:e.scroll:null,m=e?typeof e=="number"?e:e.resize:null,n=x.useRef(!1);x.useEffect(()=>(n.current=!0,()=>void(n.current=!1)));const[r,a,d]=x.useMemo(()=>{const s=()=>{if(!u.current.element)return;const{left:f,top:w,width:S,height:O,bottom:M,right:j,x:k,y:L}=u.current.element.getBoundingClientRect(),R={left:f,top:w,width:S,height:O,bottom:M,right:j,x:k,y:L};u.current.element instanceof HTMLElement&&i&&(R.height=u.current.element.offsetHeight,R.width=u.current.element.offsetWidth),Object.freeze(R),n.current&&!Zt(u.current.lastBounds,R)&&C(u.current.lastBounds=R)};return[s,m?Me(s,m):s,l?Me(s,l):s]},[C,i,l,m]);function h(){u.current.scrollContainers&&(u.current.scrollContainers.forEach(s=>s.removeEventListener("scroll",d,!0)),u.current.scrollContainers=null),u.current.resizeObserver&&(u.current.resizeObserver.disconnect(),u.current.resizeObserver=null)}function y(){u.current.element&&(u.current.resizeObserver=new c(d),u.current.resizeObserver.observe(u.current.element),t&&u.current.scrollContainers&&u.current.scrollContainers.forEach(s=>s.addEventListener("scroll",d,{capture:!0,passive:!0})))}const v=s=>{!s||s===u.current.element||(h(),u.current.element=s,u.current.scrollContainers=Ke(s),y())};return Jt(d,!!t),Kt(a),x.useEffect(()=>{h(),y()},[t,d,a]),x.useEffect(()=>h,[]),[v,p,r]}function Kt(e){x.useEffect(()=>{const t=e;return window.addEventListener("resize",t),()=>void window.removeEventListener("resize",t)},[e])}function Jt(e,t){x.useEffect(()=>{if(t){const o=e;return window.addEventListener("scroll",o,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",o,!0)}},[e,t])}function Ke(e){const t=[];if(!e||e===document.body)return t;const{overflow:o,overflowX:i,overflowY:c}=window.getComputedStyle(e);return[o,i,c].some(p=>p==="auto"||p==="scroll")&&t.push(e),[...t,...Ke(e.parentElement)]}const Qt=["x","y","top","bottom","left","right","width","height"],Zt=(e,t)=>Qt.every(o=>e[o]===t[o]),en=x.forwardRef(function({children:t,fallback:o,resize:i,style:c,gl:p,events:C=$t,eventSource:u,eventPrefix:l,shadows:m,linear:n,flat:r,legacy:a,orthographic:d,frameloop:h,dpr:y,performance:v,raycaster:s,camera:f,scene:w,onPointerMissed:S,onCreated:O,...M},j){x.useMemo(()=>Mt(gt),[]);const k=wt(),[L,R]=Yt({scroll:!0,debounce:{scroll:50,resize:0},...i}),_=x.useRef(null),T=x.useRef(null);x.useImperativeHandle(j,()=>_.current);const I=He(S),[N,W]=x.useState(!1),[H,G]=x.useState(!1);if(N)throw N;if(H)throw H;const g=x.useRef(null);te(()=>{const b=_.current;R.width>0&&R.height>0&&b&&(g.current||(g.current=Vt(b)),g.current.configure({gl:p,events:C,shadows:m,linear:n,flat:r,legacy:a,orthographic:d,frameloop:h,dpr:y,performance:v,raycaster:s,camera:f,scene:w,size:R,onPointerMissed:(...P)=>I.current==null?void 0:I.current(...P),onCreated:P=>{P.events.connect==null||P.events.connect(u?Rt(u)?u.current:u:T.current),l&&P.setEvents({compute:(A,D)=>{const F=A[l+"X"],q=A[l+"Y"];D.pointer.set(F/D.size.width*2-1,-(q/D.size.height)*2+1),D.raycaster.setFromCamera(D.pointer,D.camera)}}),O==null||O(P)}}),g.current.render(B.jsx(k,{children:B.jsx(Ne,{set:G,children:B.jsx(x.Suspense,{fallback:B.jsx(jt,{set:W}),children:t})})})))}),x.useEffect(()=>{const b=_.current;if(b)return()=>Ye(b)},[]);const E=u?"none":"auto";return B.jsx("div",{ref:T,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:E,...c},...M,children:B.jsx("div",{ref:L,style:{width:"100%",height:"100%"},children:B.jsx("canvas",{ref:_,style:{display:"block"},children:o})})})}),hn=x.forwardRef(function(t,o){return B.jsx(yt,{children:B.jsx(en,{...t,ref:o})})});let se=null,Je="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function Qe(e,t,o){return i=>{o&&o(i),e&&(se||(se=new _t),se.setDecoderPath(typeof e=="string"?e:Je),i.setDRACOLoader(se)),t&&i.setMeshoptDecoder(typeof fe=="function"?fe():fe)}}function Pe(e,t=!0,o=!0,i){return ne(Ce,e,Qe(t,o,i))}Pe.preload=(e,t=!0,o=!0,i)=>ne.preload(Ce,e,Qe(t,o,i));Pe.clear=e=>ne.clear(Ce,e);Pe.setDecoderPath=e=>{Je=e};export{hn as C,vn as a,dn as c,pn as g,Pe as u};
